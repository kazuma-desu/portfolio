---
import '@fontsource/jetbrains-mono';

interface Props {
	title: string;
}

const { title } = Astro.props;
---

<!doctype html>
<html lang="en" class="dark">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content="Kavintha Kulasingham - Senior DevOps Engineer and Linux Enthusiast" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
	</head>
	<body class="bg-terminal-900 text-terminal-100 font-mono min-h-screen relative overflow-x-hidden">
		<!-- Background Animation Canvas -->
		<canvas id="matrix-bg" class="fixed top-0 left-0 w-full h-full -z-10"></canvas>
		
		<div class="terminal-window relative z-10">
			<slot />
		</div>
	</body>
</html>

<script>
// Matrix-like code rain animation
document.addEventListener('DOMContentLoaded', function() {
	const canvas = document.getElementById('matrix-bg') as HTMLCanvasElement | null;
	
	// Add null check to ensure canvas exists
	if (!canvas) {
		console.error('Canvas element not found');
		return;
	}
	
	// Use non-null assertion to tell TypeScript that getContext will not return null
	const ctx = canvas.getContext('2d')!;
	
	// Add null check for context
	if (!ctx) {
		console.error('Could not get 2D context from canvas');
		return;
	}

	// Set canvas size to window size
	canvas.width = window.innerWidth;
	canvas.height = window.innerHeight;

	// Characters to display (Linux commands and symbols)
	const linuxChars = [
		'$', '>', '~', '|', '/', '\\', '{', '}', '[', ']', '(', ')', 
		'ls', 'cd', 'cp', 'mv', 'rm', 'cat', 'grep', 'find', 'ssh', 
		'sudo', 'apt', 'yum', 'dnf', 'git', 'vim', 'nano', 'pwd', 
		'0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
		'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm',
		'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'
	];

	// Column settings
	const fontSize = 14;
	const columns = Math.floor(canvas.width / fontSize);
	
	// Array to track the y position of each column
	const drops: number[] = [];
	
	// Initialize drops
	for (let i = 0; i < columns; i++) {
		drops[i] = Math.random() * -100;
	}
	
	// Draw function
	function draw() {
		// Create a black overlay with slight transparency
		ctx.fillStyle = 'rgba(30, 30, 46, 0.08)'; // Catppuccin base color
		ctx.fillRect(0, 0, canvas!.width, canvas!.height);
		
		// Set text color and font - using the lavender accent color
		ctx.fillStyle = 'rgba(180, 190, 254, 0.4)'; // Lavender
		ctx.font = `${fontSize}px 'JetBrains Mono', monospace`;
		
		// Loop through drops
		for (let i = 0; i < drops.length; i++) {
			// Select a random character
			const text = linuxChars[Math.floor(Math.random() * linuxChars.length)];
			
			// Randomly choose between Catppuccin colors for variety
			const rand = Math.random();
			if (rand > 0.7) {
				ctx.fillStyle = 'rgba(245, 194, 231, 0.4)'; // Pink
			} else if (rand > 0.4) {
				ctx.fillStyle = 'rgba(203, 166, 247, 0.4)'; // Mauve
			} else {
				ctx.fillStyle = 'rgba(180, 190, 254, 0.4)'; // Lavender
			}
			
			// Draw the character
			ctx.fillText(text, i * fontSize, drops[i] * fontSize);
			
			// Move the drop down
			drops[i]++;
			
			// If drop reaches bottom or randomly, reset to top
			if (drops[i] * fontSize > canvas!.height! || Math.random() > 0.99) {
				drops[i] = 0;
			}
		}
	}
	
	// Run animation
	setInterval(draw, 40);
	
	// Resize canvas when window is resized
	window.addEventListener('resize', function() {
		// Since we've already checked that canvas exists at the beginning of the function
		// and we're in the same scope, we can safely use non-null assertion
		canvas.width = window.innerWidth;
		canvas.height = window.innerHeight;
		
		// Recalculate columns
		const newColumns = Math.floor(canvas.width / fontSize);
		
		// Adjust drops array
		if (newColumns > drops.length) {
			// Add new drops if window got wider
			for (let i = drops.length; i < newColumns; i++) {
				drops[i] = Math.random() * -100;
			}
		}
	});
});
</script>

<style is:global>
	:root {
		--terminal-bg: #1e1e1e;
		--terminal-text: #f8f8f2;
		--terminal-accent: #bd93f9;
		--terminal-secondary: #ff79c6;
	}

	@tailwind base;
	@tailwind components;
	@tailwind utilities;

	@layer components {
		.terminal-window {
			@apply max-w-6xl mx-auto p-4 md:p-8;
		}

		.terminal-header {
			@apply bg-terminal-800 rounded-t-lg p-2 flex items-center gap-2 border-b border-terminal-600;
		}

		.terminal-dot {
			@apply w-3 h-3 rounded-full;
		}

		.terminal-dot-red {
			@apply bg-red-500;
		}

		.terminal-dot-yellow {
			@apply bg-yellow-500;
		}

		.terminal-dot-green {
			@apply bg-green-500;
		}

		.terminal-body {
			@apply bg-terminal-900/95 backdrop-blur-sm rounded-b-lg p-4 md:p-6 border border-terminal-700 shadow-lg;
		}

		.terminal-prompt {
			@apply text-terminal-accent font-bold;
		}

		.terminal-command {
			@apply text-terminal-300;
		}

		.terminal-command::before {
			content: '$';
			@apply text-terminal-400 mr-2;
		}

		.terminal-output {
			@apply mt-4 pl-4 border-l-2 border-terminal-accent;
		}

		.terminal-link {
			@apply text-terminal-100 hover:text-terminal-accent transition-colors duration-200 
				   border border-transparent hover:border-terminal-accent rounded px-3 py-1;
		}

		.terminal-card {
			@apply bg-terminal-800/50 backdrop-blur-sm p-4 rounded-lg border border-terminal-700 
				   hover:transform hover:-translate-y-1 transition-all duration-200
				   hover:shadow-lg hover:shadow-terminal-accent/10;
		}

		/* Fix fade-in animation to ensure content is visible by default */
		.fade-in {
			@apply opacity-100 transform-none transition-all duration-500;
		}

		.fade-in.visible {
			@apply opacity-100 translate-y-0;
		}
	}
</style>
