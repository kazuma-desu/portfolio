---
// StatusBar component - Waybar-like status bar for the landing page
---

<div class="status-bar" id="statusBar">
    <!-- Left: Open Windows/Apps -->
    <div class="status-section status-left">
        <div id="openWindowsList" class="open-windows-list"></div>
    </div>

    <!-- Center: Time and Date -->
    <div class="status-section status-center">
        <div class="time-display" id="timeDisplay">
            <span id="currentTime">--:--</span>
            <span class="date-display" id="currentDate">-- --- --</span>
        </div>
    </div>

    <!-- Right: Weather and System Info -->
    <div class="status-section status-right">
        <div class="status-item weather" id="weatherInfo">
            <i class="wi wi-day-sunny" id="weatherIcon"></i>
            <span id="weatherTemp">--°C</span>
        </div>
        <div class="status-item cpu">
            <span class="label">CPU</span>
            <span id="cpuUsage">--</span>
        </div>
        <div class="status-item memory">
            <span class="label">MEM</span>
            <span id="memUsage">--</span>
        </div>
        <div class="status-item network">
            <span class="label">NET</span>
            <span class="network-dot">●</span>
        </div>
    </div>
</div>

<style>
    .status-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 2.75rem;
        background: transparent;
        backdrop-filter: blur(8px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 0.75rem;
        gap: 0.5rem;
        z-index: 9998;
        font-family: "Monaspace Neon", monospace;
        font-size: 0.85rem;
        font-weight: 600;
        color: rgba(205, 214, 244, 0.95);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    .status-section {
        display: flex;
        align-items: center;
        gap: 0.375rem;
        flex: 1;
    }

    .status-left {
        justify-content: flex-start;
        min-width: 0;
        flex: 1;
    }

    .status-center {
        justify-content: center;
        flex: 0 0 auto;
        background: rgba(49, 50, 68, 0.7);
        border-radius: 0.625rem;
        padding: 0.45rem 0.75rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .status-right {
        justify-content: flex-end;
        gap: 0.375rem;
        flex: 1;
    }

    .open-windows-list {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        overflow-x: auto;
        scrollbar-width: none;
        -ms-overflow-style: none;
        flex-wrap: nowrap;
    }

    .open-windows-list::-webkit-scrollbar {
        display: none;
    }

    .window-tag {
        animation: fadeIn 0.3s ease;
    }

    .window-tag.closing {
        animation: fadeOut 0.4s ease forwards;
    }

    .window-tag:hover {
        background: rgba(69, 71, 90, 0.8) !important;
    }

    .window-tag:active {
        background: rgba(49, 50, 68, 0.9) !important;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.4) !important;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: scale(0.95);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    @keyframes fadeOut {
        from {
            opacity: 1;
            transform: scale(1);
        }
        to {
            opacity: 0;
            transform: scale(0.95);
        }
    }

    .time-display {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    #currentTime {
        font-size: 0.8rem;
        font-weight: 600;
        color: rgba(205, 214, 244, 1);
    }

    .date-display {
        font-size: 0.8rem;
        color: rgba(205, 214, 244, 0.85);
        font-weight: 600;
    }

    .status-item {
        display: flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.45rem 0.75rem;
        font-size: 0.8rem;
        color: rgba(205, 214, 244, 0.95);
        background: rgba(49, 50, 68, 0.7);
        border-radius: 0.625rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .status-item .label {
        color: rgba(205, 214, 244, 0.7);
        font-weight: 600;
        font-size: 0.7rem;
    }

    #weatherIcon {
        font-size: 1rem;
        line-height: 1;
        color: rgba(205, 214, 244, 0.95);
    }

    .network-dot {
        color: rgba(166, 227, 161, 1);
        font-size: 0.5rem;
    }

    @media (max-width: 1024px) {
        .status-bar {
            padding: 0 0.75rem;
            font-size: 0.75rem;
        }

        .status-item {
            padding: 0 0.375rem;
            gap: 0.25rem;
        }
    }

    @media (max-width: 768px) {
        .status-bar {
            height: 1.75rem;
            padding: 0 0.5rem;
            font-size: 0.7rem;
        }

        .status-section {
            gap: 0.375rem;
        }

        .window-tag {
            padding: 0.15rem 0.4rem;
            font-size: 0.7rem;
        }

        .status-item {
            padding: 0 0.25rem;
        }

        .date-display {
            display: none;
        }

        .status-right .status-item:not(.weather):not(.cpu) {
            display: none;
        }
    }

    @media (prefers-reduced-motion: reduce) {
        .status-item {
            transition: none;
        }
    }
</style>

<script>
    // Window labels mapping
    const windowLabels: Record<string, string> = {
        about: "About",
        skills: "Skills",
        experience: "Experience",
        contact: "Contact",
    };

    // Update time display
    function updateTime() {
        const now = new Date();
        const timeEl = document.getElementById("currentTime");
        const dateEl = document.getElementById("currentDate");

        if (timeEl) {
            const hours = now.getHours().toString().padStart(2, "0");
            const minutes = now.getMinutes().toString().padStart(2, "0");
            timeEl.textContent = `${hours}:${minutes}`;
        }

        if (dateEl) {
            const options: Intl.DateTimeFormatOptions = {
                weekday: "short",
                month: "short",
                day: "numeric",
            };
            dateEl.textContent = now.toLocaleDateString("en-US", options);
        }
    }

    // Fetch weather data from Colombo, Sri Lanka
    async function updateWeather() {
        try {
            // Using Open-Meteo API (free, no API key needed)
            // Colombo coordinates: 6.9271° N, 79.8612° E
            const response = await fetch(
                "https://api.open-meteo.com/v1/forecast?latitude=6.9271&longitude=79.8612&current=temperature_2m,weather_code&timezone=Asia/Colombo",
            );

            if (!response.ok) throw new Error("Weather fetch failed");

            const data = await response.json();
            const temp = Math.round(data.current.temperature_2m);
            const weatherCode = data.current.weather_code;

            const weatherTempEl = document.getElementById("weatherTemp");
            const weatherIconEl = document.getElementById("weatherIcon");

            if (weatherTempEl) {
                weatherTempEl.textContent = `${temp}°C`;
            }

            if (weatherIconEl) {
                // Weather code mapping (WMO codes) - using weather-icons classes
                let iconClass = "wi-day-sunny"; // Default: Clear day

                if (weatherCode === 0)
                    iconClass = "wi-day-sunny"; // Clear sky
                else if (weatherCode === 1)
                    iconClass = "wi-day-sunny-overcast"; // Mainly clear
                else if (weatherCode === 2)
                    iconClass = "wi-day-cloudy"; // Partly cloudy
                else if (weatherCode === 3)
                    iconClass = "wi-cloudy"; // Overcast
                else if (weatherCode >= 45 && weatherCode <= 48)
                    iconClass = "wi-fog"; // Fog
                else if (weatherCode >= 51 && weatherCode <= 55)
                    iconClass = "wi-sprinkle"; // Drizzle
                else if (weatherCode >= 56 && weatherCode <= 57)
                    iconClass = "wi-rain-mix"; // Freezing drizzle
                else if (weatherCode >= 61 && weatherCode <= 65)
                    iconClass = "wi-rain"; // Rain
                else if (weatherCode >= 66 && weatherCode <= 67)
                    iconClass = "wi-rain-mix"; // Freezing rain
                else if (weatherCode >= 71 && weatherCode <= 75)
                    iconClass = "wi-snow"; // Snow
                else if (weatherCode === 77)
                    iconClass = "wi-snow-wind"; // Snow grains
                else if (weatherCode >= 80 && weatherCode <= 82)
                    iconClass = "wi-showers"; // Rain showers
                else if (weatherCode >= 85 && weatherCode <= 86)
                    iconClass = "wi-snow"; // Snow showers
                else if (weatherCode >= 95 && weatherCode <= 99)
                    iconClass = "wi-thunderstorm"; // Thunderstorm

                weatherIconEl.className = "wi " + iconClass;
            }
        } catch (error) {
            console.error("Failed to fetch weather:", error);
            const weatherTempEl = document.getElementById("weatherTemp");
            if (weatherTempEl) {
                weatherTempEl.textContent = "N/A";
            }
        }
    }

    // Update mock system info
    function updateSystemInfo() {
        const cpuEl = document.getElementById("cpuUsage");
        const memEl = document.getElementById("memUsage");

        if (cpuEl) {
            const cpu = Math.floor(Math.random() * 30 + 10); // Mock: 10-40%
            cpuEl.textContent = `${cpu}%`;
        }

        if (memEl) {
            const mem = Math.floor(Math.random() * 20 + 40); // Mock: 40-60%
            memEl.textContent = `${mem}%`;
        }
    }

    // Update open windows list
    function updateOpenWindowsList() {
        const openWindowsList = document.getElementById("openWindowsList");
        if (!openWindowsList) return;

        const activeWindows = document.querySelectorAll(
            ".floating-window.active",
        );

        // Get current window IDs
        const activeIds = new Set(Array.from(activeWindows).map((w) => w.id));
        const currentTags = openWindowsList.querySelectorAll(".window-tag");

        // Mark tags for removal with animation
        currentTags.forEach((tag) => {
            const htmlTag = tag as HTMLElement;
            const windowId = htmlTag.dataset.windowId;
            if (
                windowId &&
                !activeIds.has(windowId) &&
                !tag.classList.contains("closing")
            ) {
                tag.classList.add("closing");
                setTimeout(() => {
                    if (tag.parentNode) {
                        tag.remove();
                    }
                }, 400);
            }
        });

        if (activeWindows.length === 0) {
            return;
        }

        // Get existing window IDs to avoid duplicates (excluding closing ones)
        const existingIds = new Set(
            Array.from(currentTags)
                .filter((tag) => !tag.classList.contains("closing"))
                .map((tag) => (tag as HTMLElement).dataset.windowId),
        );

        activeWindows.forEach((windowEl) => {
            const windowType = windowEl.getAttribute("data-window");
            if (!windowType) return;

            // Skip if already exists
            if (existingIds.has(windowEl.id)) return;

            const tag = document.createElement("div");
            tag.className = "window-tag";
            tag.dataset.windowId = windowEl.id;

            // Apply inline styles to match other status bar segments
            tag.style.cssText = `
                background: rgba(49, 50, 68, 0.7);
                border-radius: 0.625rem;
                padding: 0.45rem 0.75rem;
                font-size: 0.8rem;
                font-weight: 600;
                display: inline-flex;
                align-items: center;
                color: rgba(205, 214, 244, 0.95);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
                cursor: pointer;
                white-space: nowrap;
                transition: all 0.15s ease;
            `;

            const label = document.createElement("span");
            label.textContent = windowLabels[windowType] || windowType;
            label.style.fontWeight = "600";

            tag.appendChild(label);

            // Click to focus window
            tag.addEventListener("click", () => {
                const targetWindow = document.getElementById(windowEl.id);
                if (targetWindow) {
                    // Bring to front
                    const event = new CustomEvent("focusWindow", {
                        detail: { windowId: windowEl.id },
                    });
                    document.dispatchEvent(event);
                }
            });

            openWindowsList.appendChild(tag);
        });
    }

    // Initialize
    updateTime();
    updateWeather();
    updateSystemInfo();
    updateOpenWindowsList();

    // Update time every second
    setInterval(updateTime, 1000);

    // Update weather every 10 minutes
    setInterval(updateWeather, 600000);

    // Update system info every 3 seconds
    setInterval(updateSystemInfo, 3000);

    // Listen for window changes
    const observer = new MutationObserver(() => {
        updateOpenWindowsList();
    });

    // Observe all floating windows for class changes
    document.querySelectorAll(".floating-window").forEach((windowEl) => {
        observer.observe(windowEl, {
            attributes: true,
            attributeFilter: ["class"],
        });
    });

    // Cleanup on page unload
    window.addEventListener("beforeunload", () => {
        observer.disconnect();
    });
</script>
